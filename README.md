# Organization API

Organization API - это веб-сервис на базе FastAPI для справочника организаций, зданий и деятельностей с вложенной
деятельностью (до 3 уровней), географическим поиском и защищённым API.
Сервис разворачивается в Docker и предоставляет документацию Swagger.

## Основные возможности

- Создание и получение списка:
    - организаций
    - зданий
    - видов деятельности с вложенностью до 3 уровней
- Поиск организаций:
    - по ID или названию
    - по виду деятельности (с учетом вложенности)
    - по зданию
    - по географическому положению:
        - в радиусе от точки
        - в прямоугольной области
- Валидация всех запросов с помощью Pydantic-схем
- API защищено статическим ключом (`X-API-Key`)
- Swagger UI-документация
- Поддержка Docker и миграций Alembic
- Покрытие логики тестами на `pytest`

## Установка

Следуйте следующим шагам:

### Предварительные требования

- Требуются установленные [Docker](https://www.docker.com/) и [Docker Compose](https://docs.docker.com/compose/).
- `.env`  файл с персональными настройками

### Шаги

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/knopa-f1/organizations_api.git
   ```

2. Перейдите в директорию проекта:

   ```bash
   cd organizations_api
   ```

3. Соберите и запустите контейнеры приложения и базы данных с помощью команды:

   ```bash
   docker compose up --build
   ```

4. Приложение запущено. Его можно протестировать по адресу: [http://localhost:8000](http://localhost:8000).

5. Чтобы остановить сервис, используйте команду:

   ```bash
   docker-compose down
   ```
### Переменные окружения
В файле .env можно указать следующие переменные:

MODE=PROD — (по умолчанию) только структура БД, без тестовых данных

MODE=TEST — при применении миграций БД дополнительно выполняется наполнение тестовыми данными

### Миграции и тестовые данные
Миграции выполняются с помощью Alembic.
По умолчанию (MODE=PROD) применяется только структура таблиц.

Если необходимо дополнительно загрузить тестовые данные (организации, здания, виды деятельности),
необходимо в .env установить:

   ```env
   MODE=TEST
```

## API Эндпоинты

### Activities (`/activities`)

- `POST /` — создать вид деятельности
- `GET /` — получить список видов деятельности

### Buildings (`/buildings`)

- `POST /` — создать здание
- `GET /` — получить список зданий

### Organizations (`/organizations`)

- `POST /` — создать организацию
- `GET /search` — поиск организации по `id` или `name`
- `GET /list` — список организаций с фильтрацией по зданию и виду деятельности
- `GET /by_activity/{activity_id}` — организации по виду деятельности с учётом вложенности
- `GET /in_radius` — поиск организаций в радиусе от координаты (`lat`, `lng`, `radius`)
- `GET /in_rectangle` — поиск организаций в прямоугольной области (`min_lat`, `max_lat`, `min_lng`, `max_lng`)

---

Все эндпоинты защищены API-ключом в заголовке `X-API-Key`.

Подробности и схемы запросов доступны в Swagger UI: http://localhost:8000/docs

## Тесты

Тесты написаны с использованием pytest.
Запуск тестов:

   ```bash
   pytest
   ```
